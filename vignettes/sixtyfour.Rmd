---
title: "Getting Started"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting Started}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---



A science-focused, more humane R interface to AWS.


``` r
library(sixtyfour)
```

## Authentication

We leverage the package `paws` to handle AWS authentication. There are many ways to configure `paws` to authenticate with AWS - see [paws documentation](https://paws-r.github.io/developer_guide/credentials/#set-credentials).

One way to authenticate is using these three environment variables:

- `AWS_ACCESS_KEY_ID`
- `AWS_SECRET_ACCESS_KEY`
- `AWS_REGION`

You can set these three environment variables within R for the current R session like:

```
Sys.setenv(
  AWS_ACCESS_KEY_ID = "",
  AWS_SECRET_ACCESS_KEY = "",
  AWS_REGION = "us-west-2"
)
```

Or set environment variables in a variety of ways to be available across R sessions. See the [R Startup chapter][r-startup] of _What They Forgot to Teach You About R_ book for more details.


## Package API Overview

- `aws_billing*`: manage AWS billing details
- `aws_bucket*`: manage S3 buckets
- `aws_file_*`: manage files in S3 buckets
- `aws_user*`: manage AWS users
- `aws_group*`: manage AWS groups
- `aws_role*`: manage AWS roles
- `aws_policy*`/`aws_policies*`: manage AWS policies
- `aws_db*`: interact with AWS database services Redshift and RDS
- `aws_secrets*`: secrets manager
- `aws_vpc*`: VPC security groups
- `con_*`: connection classes to various AWS services
- `six_*`: magical methods

## Working with S3

We cover S3 in detail in another vignette (`vignette("s3")`), so we'll briefly touch on it here.

### Buckets

Make a random bucket name


``` r
bucket <- random_bucket()
```

Create a bucket - check if it exists first


``` r
exists <- aws_bucket_exists(bucket)

if (!exists) {
  aws_bucket_create(bucket)
}
#> [1] "http://bucket-wxjnzcavfulyeopm.s3.amazonaws.com/"
```


``` r
aws_bucket_delete(bucket)
```

### Files

First, create a bucket:


``` r
my_bucket <- random_bucket()
aws_bucket_create(my_bucket)
#> [1] "http://bucket-jnypsagozxkrdbmc.s3.amazonaws.com/"
```

Then, upload some files


``` r
temp_files <- replicate(n = 3, tempfile(fileext = ".txt"))
for (i in temp_files) cat(letters, "\n", file = i)
remote_files <- s3_path(my_bucket, basename(temp_files))
aws_file_upload(path = temp_files, remote_path = remote_files)
#> [1] "s3://bucket-jnypsagozxkrdbmc/filea2411312f6b2.txt"
#> [2] "s3://bucket-jnypsagozxkrdbmc/filea241420229e6.txt"
#> [3] "s3://bucket-jnypsagozxkrdbmc/filea2411c0cdce5.txt"
```

List files in the bucket


``` r
obs <- aws_bucket_list_objects(my_bucket)
obs
#> # A tibble: 3 × 8
#>   bucket          key   uri    size type  etag  lastmodified        storageclass
#>   <glue>          <chr> <glu> <fs:> <chr> <chr> <dttm>              <chr>       
#> 1 bucket-jnypsag… file… s3:/…    53 file  "\"a… 2025-03-07 22:24:00 STANDARD    
#> 2 bucket-jnypsag… file… s3:/…    53 file  "\"a… 2025-03-07 22:24:01 STANDARD    
#> 3 bucket-jnypsag… file… s3:/…    53 file  "\"a… 2025-03-07 22:24:01 STANDARD
```



## Billing

Billing is covered in the `vignette("billing")` vignette.

## IAM

IAM stands for Identity Access Management. IAM covers four resource types:

- Users: via `aws_user*` functions
- Groups: via `aws_group*` functions
- Roles: via `aws_role*` functions
- Policies: via `aws_policy*`/`aws_policies*` functions

As a brief example let's create a group, a user, and a role. We'll assign the user to the group. Then clean it all up.

First, create a group


``` r
group_name <- random_string("gr-")
group_name
#> gr-qrbghyxi
aws_group_create(group_name)
#> # A tibble: 1 × 5
#>   GroupName   GroupId               Path  Arn   CreateDate         
#>   <chr>       <chr>                 <chr> <chr> <dttm>             
#> 1 gr-qrbghyxi AGPA22PL7JXX3LF4SLQ5M /     ***** 2025-03-07 22:24:01
```

Then create a user


``` r
name <- random_user()
name
#> [1] "DesigningReactio"
aws_user_create(name)
#> # A tibble: 1 × 6
#>   UserName         UserId    Path  Arn   CreateDate          PasswordLastUsed
#>   <chr>            <chr>     <chr> <chr> <dttm>              <dttm>          
#> 1 DesigningReactio AIDA22PL… /     ***** 2025-03-07 22:24:02 NA
```

Now add the user to the group


``` r
aws_user_add_to_group(name, group_name)
#> $user
#> # A tibble: 1 × 6
#>   UserName         UserId    Path  Arn   CreateDate          PasswordLastUsed
#>   <chr>            <chr>     <chr> <chr> <dttm>              <dttm>          
#> 1 DesigningReactio AIDA22PL… /     ***** 2025-03-07 22:24:02 NA              
#> 
#> $policies
#> # A tibble: 0 × 0
#> 
#> $attached_policies
#> # A tibble: 0 × 0
#> 
#> $groups
#> # A tibble: 1 × 5
#>   GroupName   GroupId               Path  Arn   CreateDate         
#>   <chr>       <chr>                 <chr> <chr> <dttm>             
#> 1 gr-qrbghyxi AGPA22PL7JXX3LF4SLQ5M /     ***** 2025-03-07 22:24:01
```

Now create a role


``` r
role_name <- random_role()
trust_policy <- list(
  Version = "2012-10-17",
  Statement = list(
    list(
      Sid = "Statement1",
      Effect = "Allow",
      Principal = list(
        Service = "lambda.amazonaws.com"
      ),
      Action = "sts:AssumeRole"
    )
  )
)
doc1 <- jsonlite::toJSON(trust_policy, auto_unbox = TRUE)
aws_role_create(role_name,
  assume_role_policy_document = doc1,
  description = "test role A"
)
#> # A tibble: 1 × 7
#>   RoleName         RoleId            Path  Arn   CreateDate          Description
#>   <chr>            <chr>             <chr> <chr> <dttm>              <lgl>      
#> 1 MasteredAssignme AROA22PL7JXXY6ME… /     ***** 2025-03-07 22:24:02 NA         
#> # ℹ 1 more variable: AssumeRolePolicyDocument <chr>
```

Finally, cleanup


``` r
aws_role_delete(role_name)
six_user_delete(name)
#> ! No access keys found for DesigningReactio
#> ℹ Group gr-qrbghyxi detached
#> ℹ DesigningReactio deleted
six_group_delete(group_name)
#> ℹ group gr-qrbghyxi deleted
```

## Databases

Databases are covered in the `vignette("databases")` vignette.

## Magical methods

Magical methods are higher level functions to make your life easier.

As an example, `six_user_create()` creates a new user, including a) creating the appropriate policy if it doesn't exist yet, b) attaching the policy to the created user, and c) creating an AWS Access Key for the user (and copy an email template to your clipboard with the details the new user needs).


``` r
name <- random_user()
name
#> [1] "SeatedCornerston"
six_user_create(name)
#> ℹ Added policy UserInfo to SeatedCornerston
#> ✔ Key pair created for SeatedCornerston
#> ℹ AccessKeyId: *****
#> ℹ SecretAccessKey: *****
#> ℹ Email template copied to your clipboard
```



There are other magical methods. See the [docs](https://getwilds.org/sixtyfour/reference/#high-level-magical-methods) and the `vignette("six")` vignette for more information.

[r-startup]: https://rstats.wtf/r-startup.html
